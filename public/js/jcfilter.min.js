jQuery.fn.jcOnPageFilter = function(a) {
	a = jQuery.extend({
		animateHideNShow: false,
		focusOnLoad: false,
		caseSensitive: false,
		hideNegatives: false,
		parentLookupClass: "jcorgFilterTextParent",
		childBlockClass: "jcorgFilterTextChild",
		boxClass:"question-box",//关键字高亮容器class
		btnClass:"question form a",//触发按钮限制为class
		inputBtn:"filterFAQ"//输入框，限制为ID
	}, a);
	jQuery.expr[":"].icontains = function(a, b, c) {
		return jQuery(a).text().toUpperCase().indexOf(c[3].toUpperCase()) >= 0
	};
	if (a.focusOnLoad) {
		jQuery(this).focus()
	}
	var b = /(<span.+?>)(.+?)(<\/span>)/g;
	var c = "g";
	if (!a.caseSensitive) {
		b = /(<span.+?>)(.+?)(<\/span>)/gi;
		c = "gi"
	}
	
	$.fn.textSearch = function(str,options){
		var defaults = {
			divFlag: true,
			divStr: " ",
			markClass: "",
			markColor: "red",
			nullReport: true,
			callback: function(){
				return false;	
			}
		};
		var sets = $.extend({}, defaults, options || {}), clStr;
		if(sets.markClass){
			clStr = "class='"+sets.markClass+"'";	
		}else{
			clStr = "style='color:"+sets.markColor+";'";
		}
		
		//对前一次高亮处理的文字还原		
		$("span[rel='mark']").each(function() {
			var text = document.createTextNode($(this).text());	
			$(this).replaceWith($(text));
		});
		//字符串正则表达式关键字转化
		$.regTrim = function(s){
			var imp = /[\^\.\\\|\(\)\*\+\-\$\[\]\?\&]/g;
			var imp_c = {};
			imp_c["^"] = "\\^";
			imp_c["."] = "\\.";
			imp_c["\\"] = "\\\\";
			imp_c["|"] = "\\|";
			imp_c["("] = "\\(";
			imp_c[")"] = "\\)";
			imp_c["*"] = "\\*";
			imp_c["+"] = "\\+";
			imp_c["-"] = "\\-";
			imp_c["$"] = "\\$";
			imp_c["["] = "\\[";
			imp_c["]"] = "\\]";
			imp_c["?"] = "\\?";
			imp_c["&"] = "\\&";
			s = s.replace(imp,function(o){
				return imp_c[o];					   
			});	
			return s;
		};
		$(this).each(function(){
			var t = $(this);
			str = $.trim(str);
			if(str === ""){
//				return false;
			}else{
				//将关键字push到数组之中
				var arr = [];
				if(sets.divFlag){
					arr = str.split(sets.divStr);	
				}else{
					arr.push(str);	
				}
			}
			var v_html = t.html();
			//删除注释
			v_html = v_html.replace(/<!--(?:.*)\-->/g,"");
			
			//将HTML代码支离为HTML片段和文字片段，其中文字片段用于正则替换处理，而HTML片段置之不理
			var tags = /[^<>]+|<(\/?)([A-Za-z]+)([^<>]*)>/g;
			var a = v_html.match(tags), test = 0;
			$.each(a, function(i, c){
				if(!/<(?:.|\s)*?>/.test(c)){//非标签
					//开始执行替换
					$.each(arr,function(index, con){
						if(con === ""){return;}
						var reg = new RegExp($.regTrim(con), "g");
						if(reg.test(c)){
							//正则替换
							c = c.replace(reg,"♂"+con+"♀");
							test = 1;
						}
					});
					c = c.replace(/♂/g,"<span rel='mark' "+clStr+">").replace(/♀/g,"</span>");
					a[i] = c;
				}
			});
			//将支离数组重新组成字符串
			var new_html = a.join("");
			
			$(this).html(new_html);
			if(test === 0 && sets.nullReport){
				return false;
			}
			
			//执行回调函数
			sets.callback();
		});
	};
	return this.each(function() {
		jQuery("."+a.btnClass).click(function(d) {
			filterJs(d);
		});
		jQuery(this).keydown(function(d){
			if (d.which == 13 ||d.keyCode == 13) {
				d.preventDefault();
				filterJs(d);
			}
			//搜索框内值为空时显示全部
			var e = jQuery("#"+a.inputBtn).val();
			    eNew = jQuery.trim(e);
			if(eNew.length==0){
				$(".question-list").show();
				$("."+a.parentLookupClass).show();
				$(".search-rez").hide();
			}
		});
		
		function filterJs(d){
			var e = jQuery("#"+a.inputBtn).val();
			    e = jQuery.trim(e);
			    jQuery("#"+a.inputBtn).val(e);//去除搜索值前后的空格
			if (e.length > 0) {
				if (a.hideNegatives) {
					if (a.animateHideNShow) {
						jQuery("." + a.parentLookupClass).stop(true, true).fadeOut("slow")
					} else {
						jQuery("." + a.parentLookupClass).stop(true, true).hide()
					}
				}
				var f = "icontains";
				if (a.caseSensitive) {
					f = "contains"
				}
				jQuery.each(jQuery("." + a.childBlockClass), function(a, c) {
					jQuery(c).html(jQuery(c).html().replace(new RegExp(b), "$2"));
					jQuery(c).html(jQuery(c).html().replace(/&nbsp;/ig, ""));
				});
				jQuery.each(jQuery("." + a.childBlockClass + ":" + f + "(" + e + ")"), function(b, d) {
					if (a.hideNegatives) {
						if (a.animateHideNShow) {
							jQuery(d).parent().stop(true, true).fadeIn("slow")
						} else {
							jQuery(d).parent().stop(true, true).show()
						}
					}
				})
			} else {
				jQuery.each(jQuery("." + a.childBlockClass), function(a, c) {
					var d = jQuery(c).html().replace(new RegExp(b), "$2");
					jQuery(c).html(d)
				});
				if (a.hideNegatives) {
					if (a.animateHideNShow) {
						jQuery("." + a.parentLookupClass).stop(true, true).fadeIn("slow")
					} else {
						jQuery("." + a.parentLookupClass).stop(true, true).show()
					}
				}
			}
			jQuery("."+a.boxClass).textSearch(e);
		}
	})
}